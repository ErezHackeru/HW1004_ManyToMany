SQL Commands for HW1004:

Q.1
SELECT CUSTOMER_ID, MAX(X) FROM 
(
SELECT CUSTOMER_ID, COUNT(*) AS X
FROM ORDERS
GROUP BY CUSTOMER_ID
)

Q.2
SELECT CUST_NAME, max(SUM_PRICE) FROM(
SELECT CUST_NAME, sum(PROD_PRICE) AS SUM_PRICE FROM(
SELECT O.PRODUCT_ID , O.CUSTOMER_ID, C.NAME AS CUST_NAME, P.PRICE AS PROD_PRICE
FROM ORDERS O
JOIN PRODUCTS P ON O.PRODUCT_ID = P.ID
JOIN Customer C ON O.CUSTOMER_ID =C.ID
)
GROUP BY CUST_NAME
)

Q.3
SELECT CUST_NAME, PROD_NAME FROM(
SELECT C.NAME AS CUST_NAME, O.CUSTOMER_ID, P.name AS PROD_NAME
from Customer C
JOIN ORDERS O on O.CUSTOMER_ID = C.ID
JOIN Products P ON O.PRODUCT_ID = P.ID
) WHERE PROD_NAME = 'No_Orders_Yet'

Q.5
SELECT CUST_NAME, sum(PROD_PRICE) AS SUM_PRICE FROM(
SELECT O.PRODUCT_ID , O.CUSTOMER_ID, C.NAME AS CUST_NAME, P.PRICE AS PROD_PRICE
FROM ORDERS O
JOIN PRODUCTS P ON O.PRODUCT_ID = P.ID
JOIN Customer C ON O.CUSTOMER_ID =C.ID
)
GROUP BY CUST_NAME

Q.6
SELECT CUST_NAME, avg(PROD_PRICE) AS SUM_PRICE FROM(
SELECT O.PRODUCT_ID , O.CUSTOMER_ID, C.NAME AS CUST_NAME, P.PRICE AS PROD_PRICE
FROM ORDERS O
JOIN PRODUCTS P ON O.PRODUCT_ID = P.ID
JOIN Customer C ON O.CUSTOMER_ID =C.ID
)
GROUP BY CUST_NAME

Q.7
SELECT CUST_NAME, SUM_PRICE FROM(
SELECT CUST_NAME, avg(PROD_PRICE) AS SUM_PRICE FROM(
SELECT O.PRODUCT_ID , O.CUSTOMER_ID, C.NAME AS CUST_NAME, P.PRICE AS PROD_PRICE
FROM ORDERS O
JOIN PRODUCTS P ON O.PRODUCT_ID = P.ID
JOIN Customer C ON O.CUSTOMER_ID =C.ID
) 
GROUP BY CUST_NAME
)
WHERE SUM_PRICE > (
SELECT AVG(SUM_PRICE) FROM (
SELECT CUST_NAME, avg(PROD_PRICE) AS SUM_PRICE FROM(
SELECT O.PRODUCT_ID , O.CUSTOMER_ID, C.NAME AS CUST_NAME, P.PRICE AS PROD_PRICE
FROM ORDERS O
JOIN PRODUCTS P ON O.PRODUCT_ID = P.ID
JOIN Customer C ON O.CUSTOMER_ID =C.ID
) 
GROUP BY CUST_NAME
)
)

Q.8
SELECT SUM(PRICE) FROM(
SELECT O.CUSTOMER_ID, O.PRODUCT_ID, P.PRICE
FROM ORDERS O
JOIN Products P ON O.PRODUCT_ID = P.ID
)

Q.9
SELECT MAX(Cnt_Product), name FROM(
SELECT count(PRODUCT_ID) AS Cnt_Product, name FROM(
SELECT O.CUSTOMER_ID, O.PRODUCT_ID, P.PRICE, P.name
FROM ORDERS O
JOIN Products P ON O.PRODUCT_ID = P.ID
)
GROUP BY PRODUCT_ID
)
